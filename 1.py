# -*- coding: utf-8 -*-
# author:mistchan
import pandas as pd
import re,time,os

# time_ = time.strftime('%Y%m%d %H%M%S', time.localtime())
#
# a = '{"total":75,"rows":[{"RowIndex":61,"itemQty":69.0000,"amount":6348.0000,"createtime":"2019-12-24","itemName":"卡培他滨片","itemCurName":"卓仑","businessName":"河南东森医药有限公司","customerName":"南阳医学高等专科学校第二附属医院","shipNo":"9J0543D09","itemSpec":"0.5g*12片","itemUnit":"盒","supplierName":"河南海王医药集团有限公司","agentName":"40091","purprice":92.0000,"billPrice":92.0000,"producerdate":"2019-09-06","overduedate":"2021-09-05","billtypename":"销售","producerName":"齐鲁制药有限公司","itemNoOld":null,"itemNoNew":"11020000720","companyCodeOld":null,"companyCodeNew":"K411319298","notes":"南阳市天冠大道与纬七路交叉口&SO11040019122411606","pzwh":"国药准字H20133361","zczh":null},{"RowIndex":62,"itemQty":300.0000,"amount":27600.0000,"createtime":"2019-12-24","itemName":"卡培他滨片","itemCurName":"卓仑","businessName":"河南东森医药有限公司","customerName":"南召县人民医院","shipNo":"9J0543D09","itemSpec":"0.5g*12片","itemUnit":"盒","supplierName":"河南海王医药集团有限公司","agentName":"40091","purprice":92.0000,"billPrice":92.0000,"producerdate":"2019-09-06","overduedate":"2021-09-05","billtypename":"销售","producerName":"齐鲁制药有限公司","itemNoOld":null,"itemNoNew":"11020000720","companyCodeOld":null,"companyCodeNew":"K411300894","notes":"南召县城区光明路西&SO11040019122310944","pzwh":"国药准字H20133361","zczh":null},{"RowIndex":63,"itemQty":29.0000,"amount":2668.0000,"createtime":"2019-12-27","itemName":"卡培他滨片","itemCurName":"卓仑","businessName":"河南东森医药有限公司","customerName":"南阳市中心医院","shipNo":"9J0503D09","itemSpec":"0.5g*12片","itemUnit":"盒","supplierName":"河南海王医药集团有限公司","agentName":"40091","purprice":92.0000,"billPrice":92.0000,"producerdate":"2019-09-06","overduedate":"2021-09-05","billtypename":"销售","producerName":"齐鲁制药有限公司","itemNoOld":null,"itemNoNew":"11020000720","companyCodeOld":null,"companyCodeNew":"K411300875","notes":"南阳市工农路312号  西药房&SO11040019122713966","pzwh":"国药准字H20133361","zczh":null},{"RowIndex":64,"itemQty":10.0000,"amount":920.0000,"createtime":"2019-12-27","itemName":"卡培他滨片","itemCurName":"卓仑","businessName":"河南东森医药有限公司","customerName":"南阳市第九人民医院","shipNo":"9J0503D09","itemSpec":"0.5g*12片","itemUnit":"盒","supplierName":"河南海王医药集团有限公司","agentName":"40091","purprice":92.0000,"billPrice":92.0000,"producerdate":"2019-09-06","overduedate":"2021-09-05","billtypename":"销售","producerName":"齐鲁制药有限公司","itemNoOld":null,"itemNoNew":"11020000720","companyCodeOld":null,"companyCodeNew":"K411318666","notes":"SO11040019122714137","pzwh":"国药准字H20133361","zczh":null},{"RowIndex":65,"itemQty":1.0000,"amount":92.0000,"createtime":"2019-12-30","itemName":"卡培他滨片","itemCurName":"卓仑","businessName":"河南东森医药有限公司","customerName":null,"shipNo":"9J0543D09","itemSpec":"0.5g*12片","itemUnit":"盒","supplierName":"河南海王医药集团有限公司","agentName":"40091","purprice":92.0000,"billPrice":92.0000,"producerdate":"2019-09-06","overduedate":"2021-09-05","billtypename":"采购","producerName":"齐鲁制药有限公司","itemNoOld":null,"itemNoNew":"11020000720","companyCodeOld":null,"companyCodeNew":null,"notes":"","pzwh":"国药准字H20133361","zczh":null},{"RowIndex":66,"itemQty":-50.0000,"amount":-4600.0000,"createtime":"2020-01-01","itemName":"卡培他滨片","itemCurName":"卓仑","businessName":"河南东森医药有限公司","customerName":"南召县人民医院","shipNo":"9J0543D09","itemSpec":"0.5g*12片","itemUnit":"盒","supplierName":"河南海王医药集团有限公司","agentName":"40091","purprice":92.0000,"billPrice":92.0000,"producerdate":"2019-09-06","overduedate":"2021-09-05","billtypename":"销退","producerName":"齐鲁制药有限公司","itemNoOld":null,"itemNoNew":"11020000720","companyCodeOld":null,"companyCodeNew":"K411300894","notes":"SO11040020010101115","pzwh":"国药准字H20133361","zczh":null},{"RowIndex":67,"itemQty":1.0000,"amount":92.0000,"createtime":"2020-01-01","itemName":"卡培他滨片","itemCurName":"卓仑","businessName":"河南东森医药有限公司","customerName":"南阳市中心医院","shipNo":"9J0543D09","itemSpec":"0.5g*12片","itemUnit":"盒","supplierName":"河南海王医药集团有限公司","agentName":"40091","purprice":92.0000,"billPrice":92.0000,"producerdate":"2019-09-06","overduedate":"2021-09-05","billtypename":"销售","producerName":"齐鲁制药有限公司","itemNoOld":null,"itemNoNew":"11020000720","companyCodeOld":null,"companyCodeNew":"K411300875","notes":"南阳市工农路312号  西药房&SO11040020010100926","pzwh":"国药准字H20133361","zczh":null},{"RowIndex":68,"itemQty":50.0000,"amount":4600.0000,"createtime":"2020-01-02","itemName":"卡培他滨片","itemCurName":"卓仑","businessName":"河南东森医药有限公司","customerName":"南阳市中心医院","shipNo":"9J0543D09","itemSpec":"0.5g*12片","itemUnit":"盒","supplierName":"河南海王医药集团有限公司","agentName":"40091","purprice":92.0000,"billPrice":92.0000,"producerdate":"2019-09-06","overduedate":"2021-09-05","billtypename":"销售","producerName":"齐鲁制药有限公司","itemNoOld":null,"itemNoNew":"11020000720","companyCodeOld":null,"companyCodeNew":"K411300875","notes":"工农路312号  西药房&SO11040020010101631","pzwh":"国药准字H20133361","zczh":null},{"RowIndex":69,"itemQty":500.0000,"amount":46000.0000,"createtime":"2020-01-03","itemName":"卡培他滨片","itemCurName":"卓仑","businessName":"河南东森医药有限公司","customerName":null,"shipNo":"9L0593D09","itemSpec":"0.5g*12片","itemUnit":"盒","supplierName":"河南海王医药集团有限公司","agentName":"40091","purprice":92.0000,"billPrice":92.0000,"producerdate":"2019-11-08","overduedate":"2021-11-07","billtypename":"采购","producerName":"齐鲁制药有限公司","itemNoOld":null,"itemNoNew":"11020000720","companyCodeOld":null,"companyCodeNew":null,"notes":"","pzwh":"国药准字H20133361","zczh":null},{"RowIndex":70,"itemQty":30.0000,"amount":2760.0000,"createtime":"2020-01-03","itemName":"卡培他滨片","itemCurName":"卓仑","businessName":"河南东森医药有限公司","customerName":"南阳市中心医院","shipNo":"9L0593D09","itemSpec":"0.5g*12片","itemUnit":"盒","supplierName":"河南海王医药集团有限公司","agentName":"40091","purprice":92.0000,"billPrice":92.0000,"producerdate":"2019-11-08","overduedate":"2021-11-07","billtypename":"销售","producerName":"齐鲁制药有限公司","itemNoOld":null,"itemNoNew":"11020000720","companyCodeOld":null,"companyCodeNew":"K411300875","notes":"工农路312号  西药房&SO11040020010305238","pzwh":"国药准字H20133361","zczh":null},{"RowIndex":71,"itemQty":200.0000,"amount":18400.0000,"createtime":"2020-01-07","itemName":"卡培他滨片","itemCurName":"卓仑","businessName":"河南东森医药有限公司","customerName":"南阳医学高等专科学校第二附属医院","shipNo":"9L0593D09","itemSpec":"0.5g*12片","itemUnit":"盒","supplierName":"河南海王医药集团有限公司","agentName":"40091","purprice":92.0000,"billPrice":92.0000,"producerdate":"2019-11-08","overduedate":"2021-11-07","billtypename":"销售","producerName":"齐鲁制药有限公司","itemNoOld":null,"itemNoNew":"11020000720","companyCodeOld":null,"companyCodeNew":"K411319298","notes":"南阳市天冠大道与纬七路交叉口&SO11040020010707490","pzwh":"国药准字H20133361","zczh":null},{"RowIndex":72,"itemQty":100.0000,"amount":9200.0000,"createtime":"2020-01-08","itemName":"卡培他滨片","itemCurName":"卓仑","businessName":"河南东森医药有限公司","customerName":"南阳市中心医院","shipNo":"9L0593D09","itemSpec":"0.5g*12片","itemUnit":"盒","supplierName":"河南海王医药集团有限公司","agentName":"40091","purprice":92.0000,"billPrice":92.0000,"producerdate":"2019-11-08","overduedate":"2021-11-07","billtypename":"销售","producerName":"齐鲁制药有限公司","itemNoOld":null,"itemNoNew":"11020000720","companyCodeOld":null,"companyCodeNew":"K411300875","notes":"南阳市工农路312号  西药房&SO11040020010808505","pzwh":"国药准字H20133361","zczh":null},{"RowIndex":73,"itemQty":170.0000,"amount":15640.0000,"createtime":"2020-01-13","itemName":"卡培他滨片","itemCurName":"卓仑","businessName":"河南东森医药有限公司","customerName":"南阳市中心医院","shipNo":"9L0593D09","itemSpec":"0.5g*12片","itemUnit":"盒","supplierName":"河南海王医药集团有限公司","agentName":"40091","purprice":92.0000,"billPrice":92.0000,"producerdate":"2019-11-08","overduedate":"2021-11-07","billtypename":"销售","producerName":"齐鲁制药有限公司","itemNoOld":null,"itemNoNew":"11020000720","companyCodeOld":null,"companyCodeNew":"K411300875","notes":"南阳市工农路312号  西药房&SO11040020011311022","pzwh":"国药准字H20133361","zczh":null},{"RowIndex":74,"itemQty":-9.0000,"amount":-1558.2600,"createtime":"2019-09-23","itemName":"卡培他滨片","itemCurName":"卓仑","businessName":"河南东森医药有限公司","customerName":"南阳市中心医院","shipNo":"7J0273D09","itemSpec":"0.5g*12片","itemUnit":"盒","supplierName":"南阳市易通医药有限公司","agentName":"11105","purprice":193.2500,"billPrice":173.1400,"producerdate":"2017-09-28","overduedate":"2019-09-27","billtypename":"销退","producerName":"齐鲁制药有限公司","itemNoOld":null,"itemNoNew":"11020000720","companyCodeOld":null,"companyCodeNew":"K411300875","notes":"SO11040019091908888","pzwh":"国药准字H20133361","zczh":null},{"RowIndex":75,"itemQty":9.0000,"amount":1486.5385,"createtime":"2019-09-27","itemName":"卡培他滨片","itemCurName":"卓仑","businessName":"河南东森医药有限公司","customerName":null,"shipNo":"7J0273D09","itemSpec":"0.5g*12片","itemUnit":"盒","supplierName":"南阳市易通医药有限公司","agentName":"11105","purprice":193.2500,"billPrice":165.1709,"producerdate":"2017-09-28","overduedate":"2019-09-27","billtypename":"报损","producerName":"齐鲁制药有限公司","itemNoOld":null,"itemNoNew":"11020000720","companyCodeOld":null,"companyCodeNew":null,"notes":"","pzwh":"国药准字H20133361","zczh":null}]}'
# a = re.sub(r'null', '\'\'', a)
# b = eval(a)
# df = pd.DataFrame(b['rows'])
# df['createtime']=pd.to_datetime(df['createtime'])
# df['year'] = pd.DatetimeIndex(df['createtime']).year
#
# df['month'] = pd.DatetimeIndex(df['createtime']).month
# df['month'] = df['month'].map(str)
# df['month'] = df['month'].map(lambda x: x if len(x) == 2 else '0' + x)
# df['日期'] = df['year'].map(str) + '-' + df['month']
# print(df['日期'])
#
# summary = df.pivot_table(['itemQty'], index=['customerName'], columns=['日期','itemCurName','billtypename'], aggfunc=sum, fill_value=0)
# writer = pd.ExcelWriter('{}.xlsx'.format(time_))
# df.to_excel(writer, sheet_name='明细',index=False)
# summary.to_excel(writer, sheet_name='统计')
# writer.save()
os.system('20200114.xlsx')